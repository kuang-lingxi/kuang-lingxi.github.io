<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>mac调试chromium源码 | buuug</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="Blog">
    
    <link rel="preload" href="/assets/css/0.styles.a509abab.css" as="style"><link rel="preload" href="/assets/js/app.b8096a98.js" as="script"><link rel="preload" href="/assets/js/21.bf7b29c4.js" as="script"><link rel="preload" href="/assets/js/2.f7c58a73.js" as="script"><link rel="preload" href="/assets/js/11.2d977f36.js" as="script"><link rel="prefetch" href="/assets/js/10.9f899a40.js"><link rel="prefetch" href="/assets/js/12.6a78c77b.js"><link rel="prefetch" href="/assets/js/13.fbdd2dbb.js"><link rel="prefetch" href="/assets/js/14.a0e94ab5.js"><link rel="prefetch" href="/assets/js/15.14696e5f.js"><link rel="prefetch" href="/assets/js/16.b4d7f12b.js"><link rel="prefetch" href="/assets/js/17.a1268fee.js"><link rel="prefetch" href="/assets/js/18.e006a18f.js"><link rel="prefetch" href="/assets/js/19.dc652960.js"><link rel="prefetch" href="/assets/js/20.6871ee84.js"><link rel="prefetch" href="/assets/js/22.2b187d4a.js"><link rel="prefetch" href="/assets/js/23.b378ab73.js"><link rel="prefetch" href="/assets/js/24.7f821dca.js"><link rel="prefetch" href="/assets/js/25.3094cca7.js"><link rel="prefetch" href="/assets/js/26.b63bfa1d.js"><link rel="prefetch" href="/assets/js/27.05317306.js"><link rel="prefetch" href="/assets/js/28.5df471f1.js"><link rel="prefetch" href="/assets/js/29.460f4c4f.js"><link rel="prefetch" href="/assets/js/3.f9c8446f.js"><link rel="prefetch" href="/assets/js/30.dad3cbd3.js"><link rel="prefetch" href="/assets/js/31.f23cdcc2.js"><link rel="prefetch" href="/assets/js/32.b5d5a2db.js"><link rel="prefetch" href="/assets/js/33.af894eae.js"><link rel="prefetch" href="/assets/js/4.0bce2d4a.js"><link rel="prefetch" href="/assets/js/5.79fff311.js"><link rel="prefetch" href="/assets/js/6.ff667613.js"><link rel="prefetch" href="/assets/js/7.a5829279.js"><link rel="prefetch" href="/assets/js/8.61c949c0.js"><link rel="prefetch" href="/assets/js/9.968eca4f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a509abab.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">buuug</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="专题列表" class="dropdown-title"><span class="title">专题列表</span> <span class="arrow down"></span></button> <button type="button" aria-label="专题列表" class="mobile-dropdown-title"><span class="title">专题列表</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue/" class="nav-link">
  vue
</a></li><li class="dropdown-item"><!----> <a href="/react/" class="nav-link">
  react
</a></li><li class="dropdown-item"><!----> <a href="/css/" class="nav-link">
  css
</a></li><li class="dropdown-item"><!----> <a href="/other/" class="nav-link">
  随便写写
</a></li><li class="dropdown-item"><!----> <a href="/chromium/" class="nav-link router-link-active">
  chromium
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="专题列表" class="dropdown-title"><span class="title">专题列表</span> <span class="arrow down"></span></button> <button type="button" aria-label="专题列表" class="mobile-dropdown-title"><span class="title">专题列表</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue/" class="nav-link">
  vue
</a></li><li class="dropdown-item"><!----> <a href="/react/" class="nav-link">
  react
</a></li><li class="dropdown-item"><!----> <a href="/css/" class="nav-link">
  css
</a></li><li class="dropdown-item"><!----> <a href="/other/" class="nav-link">
  随便写写
</a></li><li class="dropdown-item"><!----> <a href="/chromium/" class="nav-link router-link-active">
  chromium
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/chromium/mac%E6%90%AD%E5%BB%BAchromium%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/" aria-current="page" class="active sidebar-link">mac搭建chromium调试环境</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chromium/mac%E6%90%AD%E5%BB%BAchromium%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/#科学上网" class="sidebar-link">科学上网</a></li><li class="sidebar-sub-header"><a href="/chromium/mac%E6%90%AD%E5%BB%BAchromium%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/#下载depot-tools" class="sidebar-link">下载depot_tools</a></li><li class="sidebar-sub-header"><a href="/chromium/mac%E6%90%AD%E5%BB%BAchromium%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/#下载chromium源码" class="sidebar-link">下载chromium源码</a></li><li class="sidebar-sub-header"><a href="/chromium/mac%E6%90%AD%E5%BB%BAchromium%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/#构建" class="sidebar-link">构建</a></li><li class="sidebar-sub-header"><a href="/chromium/mac%E6%90%AD%E5%BB%BAchromium%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/#配置lldb" class="sidebar-link">配置lldb</a></li><li class="sidebar-sub-header"><a href="/chromium/mac%E6%90%AD%E5%BB%BAchromium%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/#debug" class="sidebar-link">debug</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="mac调试chromium源码"><a href="#mac调试chromium源码" class="header-anchor">#</a> mac调试chromium源码</h1> <p>作为一个前端切图仔，接触的最多的就是浏览器，所以不管能不能看懂<code>chromium</code>的代码，先跑起来再说。这是<a href="https://chromium.googlesource.com/chromium/src/+/master/docs/mac_build_instructions.md#Install" target="_blank" rel="noopener noreferrer">官网链接<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h2 id="科学上网"><a href="#科学上网" class="header-anchor">#</a> 科学上网</h2> <p>如何科学上网就不再赘述了，我是守法好公民，大家自己感悟，当你能够科学上网以后，把你代理服务器的地址配置到<code>.bashrc</code>或者<code>.zshrc</code>里去。</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">export</span> https_proxy<span class="token operator">=</span>http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">8118</span><span class="token punctuation">;</span><span class="token keyword">export</span> http_proxy<span class="token operator">=</span>http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">8118</span>
</code></pre></div><p>注意下流量消耗…如果你要把<code>chromium</code>的代码完整下下来估计要<code>70G</code>左右，看看你的科学上网工具有没有流量限制。</p> <h2 id="下载depot-tools"><a href="#下载depot-tools" class="header-anchor">#</a> 下载depot_tools</h2> <p>你需要找一个地方下载<code>depot_tools</code>，这是<code>google</code>官方管理<code>chromium</code>的一个工具。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">git</span> clone https://chromium.googlesource.com/chromium/tools/depot_tools.git
</code></pre></div><p>下载完成后需要将<code>depot_tools</code>配置到环境变量</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token string">&quot;<span class="token environment constant">$PATH</span>:/path/to/depot_tools&quot;</span>
</code></pre></div><p>可以直接把它加到<code>.zshrc</code>文件中去（这个看你自己用的是什么<code>shell</code>），把<code>path/to/depot_tools</code>替换为<code>depot_tools</code>目录的绝对地址。例如如果我的<code>depot_tools</code>文件夹放在<code>/Volumes/ssd/chrome</code>下，所以我配置的就是</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token string">&quot;<span class="token environment constant">$PATH</span>:/Volumes/ssd/chrome/depot_tools&quot;</span>
</code></pre></div><h2 id="下载chromium源码"><a href="#下载chromium源码" class="header-anchor">#</a> 下载chromium源码</h2> <p>首先新建一个文件夹来存代码：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">mkdir</span> chromium <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> chromium
</code></pre></div><p>随后运行命令拉代码</p> <div class="language-bash extra-class"><pre class="language-bash"><code>caffeinate fetch chromium
</code></pre></div><p><code>fetch</code>就是<code>depot_tools</code>提供的一个命令，如果你没办法运行这个命令那就是你上一步没有配置好，或者配置好了没有重启终端生效。<code>caffeinate</code>的作用是阻止系统在运行<code>fetch</code>期间休眠。</p> <p>这个命令会全量拉所有内容，量非常大，可以加参数舍弃掉<code>git</code>历史数据</p> <div class="language-bash extra-class"><pre class="language-bash"><code>fetch --no-history chromium
</code></pre></div><p>后面也可以通过来获取历史数据</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">git</span> fetch --unshallow
</code></pre></div><h2 id="构建"><a href="#构建" class="header-anchor">#</a> 构建</h2> <p>下载完代码以后进入<code>src</code>文件夹</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> src
</code></pre></div><p>我们使用<code>xcode</code>来调试，运行命令生成<code>xcode</code>相关文件</p> <div class="language-bash extra-class"><pre class="language-bash"><code>gn gen --ide<span class="token operator">=</span>xcode out/debug
</code></pre></div><p>然后编辑<code>out/debug/args.gn</code>，修改相关配置参数</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Set build arguments here. See `gn help buildargs`.</span>
is_debug <span class="token operator">=</span> <span class="token boolean">true</span>
is_component_build <span class="token operator">=</span> <span class="token boolean">true</span>
symbol_level <span class="token operator">=</span> <span class="token number">2</span>
</code></pre></div><p>这块因为我们的目的是<code>debug</code>，所以和官网上配置的参数不太一样，按照官网上的参数配置编译速度会快但是并不能用于<code>debug</code>。更多的参数解释也可以看<a href="https://www.chromium.org/developers/gn-build-configuration/" target="_blank" rel="noopener noreferrer">这篇文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>随后我们使用<code>xcode</code>打开<code>all.xcodeproj</code>文件，打开后选择<code>Automatically Create Schemes</code>。将上方的选项切换成<code>All</code></p> <p><img src="/assets/img/checkAll.c37e2500.png" alt=""></p> <p>最后就可以直接点击<code>xcode</code>的三角形进行编译，这个步骤会非常漫长。</p> <h2 id="配置lldb"><a href="#配置lldb" class="header-anchor">#</a> 配置<strong>lldb</strong></h2> <p>编译完成后按照<a href="https://chromium.googlesource.com/chromium/src/+/HEAD/docs/lldbinit.md" target="_blank" rel="noopener noreferrer">官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>来配置<code>lldb</code>，确认你电脑上是否存在<code>.lldbinit</code>文件，如果没有新建一个<code>.lldbinit</code>文件。在官网上我们也能看见它要求我们的配置文件is_debug=true，symbol_level=2。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">touch</span> ~/.lldbinit
</code></pre></div><p>然后把下面的代码复制进去</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># So that lldbinit.py takes precedence.</span>
script sys.path<span class="token punctuation">[</span>:0<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'/&lt;your-path&gt;/chromium/src/tools/lldb'</span><span class="token punctuation">]</span>
script <span class="token function">import</span> lldbinit
</code></pre></div><p>注意要把<code>&lt;your-path&gt;</code>替换为你的真实路径。做完这个之后我们就不用管后面的<strong>How to attach to a process with lldb and start debugging</strong>章节了，我们使用<code>xcode</code>来进行<code>debug</code>。</p> <h2 id="debug"><a href="#debug" class="header-anchor">#</a> debug</h2> <p>这里终于来到了最后一步，之前的编译已经生成了一个可运行的<code>Chromium</code>，运行<code>out/debug/Chromium.app/Contents/MacOS/Chromium</code></p> <p>我们给<code>NewTabButton::NotifyClick</code>打一个断点，可以直接全局搜一下：</p> <p><img src="/assets/img/debug.5d39988e.png" alt="Untitled"></p> <p>然后去<code>xcode→debug→attach to process</code>中选中你要调试的线程。</p> <p><img src="/assets/img/attach.e8809d43.png" alt="Untitled"></p> <p>随后在打开的<code>chromium</code>中点击<code>+</code>新建一个<code>tab</code>，不出意外的话就会被断点中断</p> <p><img src="/assets/img/success.3112c463.png" alt="Untitled"></p> <p>至此，就已经将整个流程跑通了，后续可以研究研究你感兴趣的代码。</p></div> <footer class="page-edit"><!----> <!----></footer> <!---->  <!----></main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.b8096a98.js" defer></script><script src="/assets/js/21.bf7b29c4.js" defer></script><script src="/assets/js/2.f7c58a73.js" defer></script><script src="/assets/js/11.2d977f36.js" defer></script>
  </body>
</html>
