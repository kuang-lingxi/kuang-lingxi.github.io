(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{454:function(s,t,a){s.exports=a.p+"assets/img/checkAll.c37e2500.png"},455:function(s,t,a){s.exports=a.p+"assets/img/debug.5d39988e.png"},456:function(s,t,a){s.exports=a.p+"assets/img/attach.e8809d43.png"},457:function(s,t,a){s.exports=a.p+"assets/img/success.3112c463.png"},577:function(s,t,a){"use strict";a.r(t);var e=a(59),r=Object(e.a)({},(function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"mac调试chromium源码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#mac调试chromium源码"}},[s._v("#")]),s._v(" mac调试chromium源码")]),s._v(" "),e("p",[s._v("作为一个前端切图仔，接触的最多的就是浏览器，所以不管能不能看懂"),e("code",[s._v("chromium")]),s._v("的代码，先跑起来再说。这是"),e("a",{attrs:{href:"https://chromium.googlesource.com/chromium/src/+/master/docs/mac_build_instructions.md#Install",target:"_blank",rel:"noopener noreferrer"}},[s._v("官网链接"),e("OutboundLink")],1),s._v("。")]),s._v(" "),e("h2",{attrs:{id:"科学上网"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#科学上网"}},[s._v("#")]),s._v(" 科学上网")]),s._v(" "),e("p",[s._v("如何科学上网就不再赘述了，我是守法好公民，大家自己感悟，当你能够科学上网以后，把你代理服务器的地址配置到"),e("code",[s._v(".bashrc")]),s._v("或者"),e("code",[s._v(".zshrc")]),s._v("里去。")]),s._v(" "),e("div",{staticClass:"language-jsx extra-class"},[e("pre",{pre:!0,attrs:{class:"language-jsx"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" https_proxy"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8118")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" http_proxy"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8118")]),s._v("\n")])])]),e("p",[s._v("注意下流量消耗…如果你要把"),e("code",[s._v("chromium")]),s._v("的代码完整下下来估计要"),e("code",[s._v("70G")]),s._v("左右，看看你的科学上网工具有没有流量限制。")]),s._v(" "),e("h2",{attrs:{id:"下载depot-tools"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#下载depot-tools"}},[s._v("#")]),s._v(" 下载depot_tools")]),s._v(" "),e("p",[s._v("你需要找一个地方下载"),e("code",[s._v("depot_tools")]),s._v("，这是"),e("code",[s._v("google")]),s._v("官方管理"),e("code",[s._v("chromium")]),s._v("的一个工具。")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://chromium.googlesource.com/chromium/tools/depot_tools.git\n")])])]),e("p",[s._v("下载完成后需要将"),e("code",[s._v("depot_tools")]),s._v("配置到环境变量")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),s._v(':/path/to/depot_tools"')]),s._v("\n")])])]),e("p",[s._v("可以直接把它加到"),e("code",[s._v(".zshrc")]),s._v("文件中去（这个看你自己用的是什么"),e("code",[s._v("shell")]),s._v("），把"),e("code",[s._v("path/to/depot_tools")]),s._v("替换为"),e("code",[s._v("depot_tools")]),s._v("目录的绝对地址。例如如果我的"),e("code",[s._v("depot_tools")]),s._v("文件夹放在"),e("code",[s._v("/Volumes/ssd/chrome")]),s._v("下，所以我配置的就是")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),s._v(':/Volumes/ssd/chrome/depot_tools"')]),s._v("\n")])])]),e("h2",{attrs:{id:"下载chromium源码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#下载chromium源码"}},[s._v("#")]),s._v(" 下载chromium源码")]),s._v(" "),e("p",[s._v("首先新建一个文件夹来存代码：")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" chromium "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" chromium\n")])])]),e("p",[s._v("随后运行命令拉代码")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("caffeinate fetch chromium\n")])])]),e("p",[e("code",[s._v("fetch")]),s._v("就是"),e("code",[s._v("depot_tools")]),s._v("提供的一个命令，如果你没办法运行这个命令那就是你上一步没有配置好，或者配置好了没有重启终端生效。"),e("code",[s._v("caffeinate")]),s._v("的作用是阻止系统在运行"),e("code",[s._v("fetch")]),s._v("期间休眠。")]),s._v(" "),e("p",[s._v("这个命令会全量拉所有内容，量非常大，可以加参数舍弃掉"),e("code",[s._v("git")]),s._v("历史数据")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("fetch --no-history chromium\n")])])]),e("p",[s._v("后面也可以通过来获取历史数据")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" fetch --unshallow\n")])])]),e("h2",{attrs:{id:"构建"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#构建"}},[s._v("#")]),s._v(" 构建")]),s._v(" "),e("p",[s._v("下载完代码以后进入"),e("code",[s._v("src")]),s._v("文件夹")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" src\n")])])]),e("p",[s._v("我们使用"),e("code",[s._v("xcode")]),s._v("来调试，运行命令生成"),e("code",[s._v("xcode")]),s._v("相关文件")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("gn gen --ide"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("xcode out/debug\n")])])]),e("p",[s._v("然后编辑"),e("code",[s._v("out/debug/args.gn")]),s._v("，修改相关配置参数")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Set build arguments here. See `gn help buildargs`.")]),s._v("\nis_debug "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\nis_component_build "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\nsymbol_level "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n")])])]),e("p",[s._v("这块因为我们的目的是"),e("code",[s._v("debug")]),s._v("，所以和官网上配置的参数不太一样，按照官网上的参数配置编译速度会快但是并不能用于"),e("code",[s._v("debug")]),s._v("。更多的参数解释也可以看"),e("a",{attrs:{href:"https://www.chromium.org/developers/gn-build-configuration/",target:"_blank",rel:"noopener noreferrer"}},[s._v("这篇文档"),e("OutboundLink")],1),s._v("。")]),s._v(" "),e("p",[s._v("随后我们使用"),e("code",[s._v("xcode")]),s._v("打开"),e("code",[s._v("all.xcodeproj")]),s._v("文件，打开后选择"),e("code",[s._v("Automatically Create Schemes")]),s._v("。将上方的选项切换成"),e("code",[s._v("All")])]),s._v(" "),e("p",[e("img",{attrs:{src:a(454),alt:""}})]),s._v(" "),e("p",[s._v("最后就可以直接点击"),e("code",[s._v("xcode")]),s._v("的三角形进行编译，这个步骤会非常漫长。")]),s._v(" "),e("h2",{attrs:{id:"配置lldb"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置lldb"}},[s._v("#")]),s._v(" 配置"),e("strong",[s._v("lldb")])]),s._v(" "),e("p",[s._v("编译完成后按照"),e("a",{attrs:{href:"https://chromium.googlesource.com/chromium/src/+/HEAD/docs/lldbinit.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("官网"),e("OutboundLink")],1),s._v("来配置"),e("code",[s._v("lldb")]),s._v("，确认你电脑上是否存在"),e("code",[s._v(".lldbinit")]),s._v("文件，如果没有新建一个"),e("code",[s._v(".lldbinit")]),s._v("文件。在官网上我们也能看见它要求我们的配置文件is_debug=true，symbol_level=2。")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" ~/.lldbinit\n")])])]),e("p",[s._v("然后把下面的代码复制进去")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# So that lldbinit.py takes precedence.")]),s._v("\nscript sys.path"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(":0"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/<your-path>/chromium/src/tools/lldb'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nscript "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" lldbinit\n")])])]),e("p",[s._v("注意要把"),e("code",[s._v("<your-path>")]),s._v("替换为你的真实路径。做完这个之后我们就不用管后面的"),e("strong",[s._v("How to attach to a process with lldb and start debugging")]),s._v("章节了，我们使用"),e("code",[s._v("xcode")]),s._v("来进行"),e("code",[s._v("debug")]),s._v("。")]),s._v(" "),e("h2",{attrs:{id:"debug"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#debug"}},[s._v("#")]),s._v(" debug")]),s._v(" "),e("p",[s._v("这里终于来到了最后一步，之前的编译已经生成了一个可运行的"),e("code",[s._v("Chromium")]),s._v("，运行"),e("code",[s._v("out/debug/Chromium.app/Contents/MacOS/Chromium")])]),s._v(" "),e("p",[s._v("我们给"),e("code",[s._v("NewTabButton::NotifyClick")]),s._v("打一个断点，可以直接全局搜一下：")]),s._v(" "),e("p",[e("img",{attrs:{src:a(455),alt:"Untitled"}})]),s._v(" "),e("p",[s._v("然后去"),e("code",[s._v("xcode→debug→attach to process")]),s._v("中选中你要调试的线程。")]),s._v(" "),e("p",[e("img",{attrs:{src:a(456),alt:"Untitled"}})]),s._v(" "),e("p",[s._v("随后在打开的"),e("code",[s._v("chromium")]),s._v("中点击"),e("code",[s._v("+")]),s._v("新建一个"),e("code",[s._v("tab")]),s._v("，不出意外的话就会被断点中断")]),s._v(" "),e("p",[e("img",{attrs:{src:a(457),alt:"Untitled"}})]),s._v(" "),e("p",[s._v("至此，就已经将整个流程跑通了，后续可以研究研究你感兴趣的代码。")])])}),[],!1,null,null,null);t.default=r.exports}}]);